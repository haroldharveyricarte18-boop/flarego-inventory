<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <style>
        :root {
            --primary: #4361ee;
            --success: #2ecc71;
            --danger: #e74c3c;
            --dark: #2b2d42;
            --bg: #f8f9fa;
        }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; margin: 0; background: var(--bg); color: var(--dark); }
        .container { width: 100%; max-width: 800px; padding: 40px 20px; margin: 0 auto; }
        
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .export-btn { 
            background: white; color: var(--primary); border: 2px solid var(--primary); 
            padding: 10px 18px; border-radius: 12px; text-decoration: none; 
            font-weight: 700; font-size: 0.85em; transition: all 0.2s;
        }
        .export-btn:hover { background: var(--primary); color: white; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--primary); color: white; padding: 20px; border-radius: 16px; box-shadow: 0 10px 20px rgba(67, 97, 238, 0.2); }
        .stat-card h4 { margin: 0; opacity: 0.8; font-size: 0.9em; text-transform: uppercase; }
        .stat-card .value { font-size: 2em; font-weight: 800; margin-top: 5px; }

        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #edf2f7; }
        
        .toggle-btn { 
            width: 100%; background: var(--dark); color: white; border: none; padding: 15px; 
            border-radius: 12px; cursor: pointer; font-weight: 700; display: flex; 
            justify-content: space-between; align-items: center; transition: background 0.2s;
        }
        .toggle-btn:hover { background: #1a1c2c; }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.85em; color: #64748b; }
        input, select { 
            width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; 
            font-size: 14px; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: var(--primary); }
        
        .add-btn-main { 
            background: var(--primary); color: white; border: none; padding: 14px; 
            width: 100%; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 10px;
        }

        .product-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f5f9; }
        .product-item:last-child { border-bottom: none; }
        .product-meta { display: flex; align-items: center; gap: 10px; }
        .price-tag { color: var(--success); font-weight: 700; font-size: 1.1em; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75em; font-weight: 700; background: #f1f5f9; color: #475569; }
        .badge.low-stock { background: #fee2e2; color: var(--danger); border: 1px solid #fecaca; }

        .btn-group { display: flex; gap: 10px; }
        .edit-link { color: var(--primary); text-decoration: none; font-weight: 600; font-size: 0.85em; }
        .delete-link { color: var(--danger); text-decoration: none; font-weight: 600; font-size: 0.85em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-flex">
            <h1 style="margin: 0;">Flarego Inventory Dashboard</h1>
            <a href="/export" class="export-btn">Download CSV</a>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Total Stock Value</h4>
                <div class="value">${{.TotalValue}}</div>
            </div>
            <div class="stat-card" style="background: var(--dark);">
                <h4>Items Tracked</h4>
                <div class="value">{{len .Products}}</div>
            </div>
        </div>

        <div class="card" style="padding: 15px;">
            <button class="toggle-btn" onclick="toggleForm()">
                <span>{{if .EditItem}}üìù Editing: {{.EditItem.Name}}{{else}}‚ûï Register New Product{{end}}</span>
                <span id="toggle-icon">{{if .IsEditing}}‚ñ≤{{else}}‚ñº{{end}}</span>
            </button>

            <div id="form-content" style="display: {{if .IsEditing}}block{{else}}none{{end}}; padding-top: 20px;">
                <form action="/add" method="POST">
                    <input type="hidden" name="id" value="{{if ne .EditIdx -1}}{{.EditIdx}}{{end}}">
                    
                    <div class="form-group">
                        <label>Product Name</label>
                        <input type="text" name="name" value="{{if .EditItem}}{{.EditItem.Name}}{{end}}" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Unit Price</label>
                            <input type="text" name="price" value="{{if .EditItem}}{{.EditItem.Price}}{{end}}" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Stock Quantity</label>
                            <input type="number" name="stock" value="{{if .EditItem}}{{.EditItem.Stock}}{{end}}" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" name="desc" value="{{if .EditItem}}{{.EditItem.Desc}}{{end}}" required>
                    </div>
                    
                    <button type="submit" class="add-btn-main">{{if .EditItem}}Update Product{{else}}Confirm Add Product{{end}}</button>
                    {{if .EditItem}}
                    <a href="/" style="display:block; text-align:center; margin-top:15px; color:#94a3b8; font-size:13px; text-decoration:none;">Cancel Edit</a>
                    {{end}}
                </form>
            </div>
        </div>

        <div class="card">
            <form action="/" method="GET" style="display: flex; gap: 10px;">
                <input type="text" name="search" placeholder="Search inventory..." value="{{.Search}}" style="flex: 2;">
                <select name="sort" onchange="this.form.submit()" style="flex: 1;">
                    <option value="">Sort By</option>
                    <option value="name" {{if eq .SortBy "name"}}selected{{end}}>Name (A-Z)</option>
                    <option value="price" {{if eq .SortBy "price"}}selected{{end}}>Price (Low-High)</option>
                </select>
                <a href="/" style="padding: 12px; color: #94a3b8; text-decoration: none; font-size: 14px;">Clear</a>
            </form>
        </div>

        <div class="card">
            <h3 style="margin-top: 0; border-bottom: 2px solid var(--bg); padding-bottom: 10px;">Live Stock List</h3>
            {{range $index, $element := .Products}}
            <div class="product-item">
                <div>
                    <div class="product-meta">
                        <strong style="font-size: 1.1em;">{{$element.Name}}</strong>
                        <span class="badge {{if le $element.NumericStock 5}}low-stock{{end}}">
                            {{$element.Stock}} Units
                        </span>
                    </div>
                    <p style="margin: 5px 0; color: #64748b; font-size: 0.9em;">{{$element.Desc}}</p>
                    <div class="price-tag">{{$element.Price}}</div>
                </div>
                <div class="btn-group">
                    <a href="/?edit={{$index}}" class="edit-link">Edit</a>
                    <a href="/delete?id={{$index}}" class="delete-link" onclick="return confirm('Delete item?')">Delete</a>
                </div>
            </div>
            {{else}}
            <p style="text-align: center; color: #94a3b8; padding: 20px;">No products in database.</p>
            {{end}}
        </div>
    </div>

    <script>
        function toggleForm() {
            const content = document.getElementById('form-content');
            const icon = document.getElementById('toggle-icon');
            if (content.style.display === "none") {
                content.style.display = "block";
                icon.innerText = "‚ñ≤";
            } else {
                content.style.display = "none";
                icon.innerText = "‚ñº";
            }
        }
    </script>
</body>
</html>