<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flarego Inventory</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            margin: 0; 
            background: var(--bg); 
            color: var(--text-main);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }

        /* --- PREMIUM BRAND HEADER --- */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .brand { 
            display: flex; 
            align-items: center; 
            gap: 18px; 
        }
        
        .logo-container {
            width: 62px;
            height: 62px;
            background: var(--primary);
            border-radius: 18px; /* Precise squircle radius */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 24px -6px rgba(99, 102, 241, 0.4);
        }

        .brand-text {
            margin: 0;
            font-weight: 800;
            font-size: 2.4rem;
            color: var(--dark);
            letter-spacing: -1.8px;
            line-height: 1;
        }

        .brand-text span { color: var(--primary); }

        /* --- STATS & CARDS --- */
        .stats-grid { 
            display: grid; 
            grid-template-columns: 1.2fr 1fr 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 40px; 
        }

        .stat-card { 
            background: var(--card-bg); 
            padding: 24px; 
            border-radius: 20px; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .stat-card h4 { margin: 0; font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-card .value { font-size: 1.5rem; font-weight: 800; margin-top: 8px; color: var(--dark); }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        /* --- UI COMPONENTS --- */
        .btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39); }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }

        .btn-outline { border: 2px solid #e2e8f0; color: var(--text-main); background: white; }
        .btn-outline:hover { background: #f8fafc; border-color: #cbd5e1; }

        .card { 
            background: var(--card-bg); 
            border-radius: 24px; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); 
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .inventory-header {
            padding: 24px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 100px;
            padding: 20px 24px;
            align-items: center;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }

        .product-row:hover { 
            background: #f8fafc; 
            border-left: 4px solid var(--primary);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-block;
        }

        .status-ok { background: #ecfdf5; color: var(--success); }
        .status-low { background: #fff7ed; color: var(--warning); }
        .status-critical { background: #fef2f2; color: var(--danger); }

        .form-section { padding: 30px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
        input { 
            width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid #cbd5e1; 
            box-sizing: border-box; font-family: inherit; font-size: 0.95rem;
        }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; color: var(--text-muted); }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div class="brand">
                <div class="logo-container">
                    <svg width="32" height="32" viewBox="0 0 200 300" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M95.5 10C95.5 10 50 60 50 145C50 215 95 255 110 255C125 255 170 215 170 145C170 75 120 10 120 10C120 10 150 50 150 125C150 185 115 220 115 220C115 220 80 185 80 125C80 65 110 10 110 10" fill="white"/>
                        <path opacity="0.4" d="M110 280C140 280 165 255 165 220C165 195 150 170 115 140C80 170 65 195 65 220C65 255 80 280 110 280Z" fill="white"/>
                    </svg>
                </div>
                <h1 class="brand-text">Flare<span>go</span></h1>
            </div>

            <div style="display: flex; gap: 12px;">
                <a href="/export" class="btn btn-outline">ðŸ“¥ Export CSV</a>
                <button onclick="toggleForm()" class="btn btn-primary">âž• New Product</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card" style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 60px; height: 60px;"><canvas id="healthChart"></canvas></div>
                <div>
                    <h4>Health</h4>
                    <div class="value">{{.HealthScore}}%</div>
                </div>
            </div>
            <div class="stat-card">
                <h4>Total Units</h4>
                <div class="value">{{.TotalStockItems}}</div>
            </div>
            <div class="stat-card">
                <h4>Valuation</h4>
                <div class="value">â‚±{{.TotalValue}}</div> 
            </div>
            <div class="stat-card" style="border-bottom: 4px solid var(--success);">
                <h4>Est. Profit</h4>
                <div class="value" style="color: var(--success);">â‚±{{.TotalProfit}}</div> 
            </div>
        </div>

        <div class="main-layout">
            <div class="card">
                <div id="form-content" class="form-section" style="display: {{if .IsEditing}}block{{else}}none{{end}};">
                    <h3 style="margin-top:0">{{if .EditItem}}Edit Product{{else}}Add New Product{{end}}</h3>
                    <form action="/add" method="POST">
                        <input type="hidden" name="id" value="{{if ne .EditIdx -1}}{{.EditIdx}}{{end}}">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
                            <div class="input-group">
                                <label>Product Name</label>
                                <input type="text" name="name" value="{{if .EditItem}}{{.EditItem.Name}}{{end}}" required>
                            </div>
                            <div class="input-group">
                                <label>Price (Sell) â‚±</label>
                                <input type="text" name="price" value="{{if .EditItem}}{{.EditItem.Price}}{{end}}" placeholder="0.00" required>
                            </div>
                            <div class="input-group">
                                <label>Cost (Buy) â‚±</label>
                                <input type="number" step="0.01" name="cost_price" value="{{if .EditItem}}{{.EditItem.CostPrice}}{{end}}" placeholder="0.00" required>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 3fr; gap: 15px; margin-top: 15px;">
                            <div class="input-group">
                                <label>Stock</label>
                                <input type="number" name="stock" value="{{if .EditItem}}{{.EditItem.Stock}}{{end}}" required>
                            </div>
                            <div class="input-group">
                                <label>Description</label>
                                <input type="text" name="desc" value="{{if .EditItem}}{{.EditItem.Desc}}{{end}}" required>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                            <a href="/" class="btn btn-outline">Cancel</a>
                        </div>
                    </form>
                </div>

                <div class="inventory-header">
                    <h3 style="margin:0">Live Inventory</h3>
                    <form action="/" method="GET">
                        <input type="text" name="search" placeholder="Search products..." value="{{.Search}}" style="width: 250px;">
                    </form>
                </div>

                {{range .Products}}
                <div class="product-row">
                    <div>
                        <div style="font-weight: 700; color: var(--dark);">{{.Name}}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">{{.Desc}}</div>
                    </div>
                    <div>
                        <span class="status-badge {{if le .NumericStock 0}}status-critical{{else if le .NumericStock 5}}status-low{{else}}status-ok{{end}}">
                            {{.Stock}} Units
                        </span>
                    </div>
                    <div style="font-weight: 800;">â‚±{{.Price}}</div>
                    <div style="text-align: right;">
                        <a href="/?edit={{.ID}}" style="color: var(--primary); margin-right: 10px; text-decoration: none; font-size: 0.8rem; font-weight: 700;">Edit</a>
                        <a href="/delete?id={{.ID}}" onclick="return confirm('Delete?')" style="color: var(--danger); text-decoration: none; font-size: 0.8rem; font-weight: 700;">Del</a>
                    </div>
                </div>
                {{else}}
                <div style="padding: 60px; text-align: center; color: var(--text-muted);">No products found.</div>
                {{end}}
            </div>

            <div class="card" style="padding: 24px;">
                <h3 style="margin-top: 0; font-size: 1rem;">Recent Activity</h3>
                {{range .Logs}}
                <div style="padding: 12px 0; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem;">
                    <div style="font-weight: 700; color: var(--primary); font-size: 0.7rem; text-transform: uppercase;">{{.Action}}</div>
                    <div style="font-weight: 600;">{{.ProductName}}</div>
                    <div style="font-size: 0.7rem; color: var(--text-muted);">{{.CreatedAt.Format "Jan 02, 15:04"}}</div>
                </div>
                {{else}}
                <p style="font-size: 0.8rem; color: var(--text-muted);">No recent logs.</p>
                {{end}}
            </div>
        </div>

        <p style="text-align:center; font-size: 0.8rem; color: var(--text-muted); margin-top: 40px;">
            <b>Flarego ERP v2.0</b> â€¢ Cloud SQL Connected â€¢ Admin Session
        </p>
    </div>

    <script>
        function toggleForm() {
            const f = document.getElementById('form-content');
            f.style.display = f.style.display === 'none' ? 'block' : 'none';
        }

        const ctx = document.getElementById('healthChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [Number("{{.HealthScore}}"), Number("{{sub 100 .HealthScore}}")],
                    backgroundColor: ['#6366f1', '#f1f5f9'],
                    borderWidth: 0
                }]
            },
            options: { cutout: '70%', plugins: { legend: { display: false } } }
        });
    </script>
</body>
</html>